import socket
import time
import threading

# Function to scan a single port
def scanner(ip, port):
    try:
        sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        sock.settimeout(0.5)  # Lower timeout for faster scanning
        result = sock.connect_ex((ip, port))
        if result == 0:
            print(f"[!] Port {port} is open")
        sock.close()
    except:
        pass  # Ignore errors to avoid script crashes

# Function to handle multiple threads
def thread_scan(ip, start_port, end_port):
    threads = []
    
    print(f"[~] Scanning {ip} from port {start_port} to port {end_port}...")
    
    for port in range(start_port, end_port + 1):
        thread = threading.Thread(target=scanner, args=(ip, port))
        thread.start()
        threads.append(thread)
        
        if len(threads) >= 100:  # Limit number of concurrent threads
            for t in threads:
                t.join()  # Wait for current batch to finish
            threads = []  # Reset thread list

    # Ensure all remaining threads complete
    for t in threads:
        t.join()

# Main function
def main():
    ip_addr = input("[~] What IP address do you want to scan: ")
    port_range = input("[~] Enter port range (separated by a comma, e.g. '20,1024'): ").split(',')

    if len(port_range) != 2 or not port_range[0].isdigit() or not port_range[1].isdigit():
        print("[-] Invalid port range input!")
        return

    start_port, end_port = int(port_range[0]), int(port_range[1])

    start_time = time.time()
    thread_scan(ip_addr, start_port, end_port)
    end_time = time.time()

    print(f"Scanned {end_port - start_port + 1} ports in {end_time - start_time:.2f} seconds.")

if __name__ == "__main__":
    main()
